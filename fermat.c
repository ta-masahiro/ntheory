#include <stdio.h>
#include <stdlib.h>
#include <gmp.h>
#define TRUE 1
#define  FALSE 0

int fermat(mpz_t n, mpz_t a) {
    mpz_t b2; mpz_init(b2);

    mpz_sqrt(a, n);                         // a=√a
    mpz_mul(b2,a,a); mpz_sub(b2,b2,n);      // b2=a*a-n
    while (mpz_perfect_square_p(b2) ==0 ) { // b2が平方数でない限り
        mpz_add_ui(a,a,1);                  // a =a+1
        mpz_mul(b2,a,a); mpz_sub(b2, b2, n);// b2 =a*a-n
    }
    mpz_sqrt(b2,b2);mpz_sub(a,a,b2);        // a=a-√b
}
//差が15bitの2数の積4096bit整数を分解可能　103418607466800544686566165
//15782083695141588035522440055811333488072182596961369751867680575328
//05396894757503164834709575083359161158060701923008831149233177215596
//30539574986230070077229838652263656220361166821160135907893936645293
//34484013727831498650704050329465026921959603371524903932577186817759
//69357953766124434670452760182942622011519373645653657784274264774773
//27084708954043236948950890929069799292705740438921850954164404219744
//82964172766869639959274145415147787102788200306492279763497650709082
//07584414253880096569270321293357683127769728901749940165024782079154
//83957041923549002810825653912509062657137364325745552182076780580821
//44041759007361094285132895459542415519950584987374725607047368940144
//65695117165251699935296644992760434412206519036326801985540077086806
//22846441143817541631795813395958669101105780814123430088369293243602
//21226637811608234727362989143040298036836973898801562225280456230454
//36226522780569221934366978973936408257173404970887883159180079205465
//19588495518660531066582622697545417103507501628041768301162312438031
//24030514259407059206256605675846067962180386269462342258647068782396
//46554381165540673005572649955471689205027195933802181344480474070023
//069194083134722979170599617466579222550596280381011
int main(int argc, char * argv[]) {
    mpz_t a; mpz_init(a);
    mpz_t  n; mpz_init_set_str(n, argv[1], 10);
    if (mpz_probab_prime_p (n,20)) 
        printf("%s is prime\n",mpz_get_str(NULL,10,n));
    else  {
        fermat(n,a) ;
        mpz_tdiv_q(n,n,a);
        printf("%s is  %s * %s\n",  argv[1], mpz_get_str(NULL,10,a), mpz_get_str(NULL,10,n));
    } 
}
